% Add dots in the table of contents
\renewcommand{\cftdotsep}{1}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

% Command for creating a lined text box with a label
\newcommand{\linedtext}[2]{%
  \makebox[#1][l]{\underline{\hspace{#1}\vphantom{g}}}%
  \llap{\makebox[#1][c]{#2}}%
}

% Command for creating an unnumbered section with a label
\newcommand{\unnumsection}[1]{%
  \phantomsection%
  \addcontentsline{toc}{section}{#1}%
  \section*{#1}%
}

% Command for creating an unnumbered subsection with a label
\newcommand{\unnumsubsection}[1]{%
  \phantomsection%
  \addcontentsline{toc}{subsection}{#1}%
  \subsection*{#1}%
}

% Command for paragraph with a new line
\newcommand{\nlparagraph}[1]{\paragraph{#1}\mbox{}\\\hspace*{\parindent}}

% Create new listing types
\newtcblisting{terminalstyle}{
        enhanced,
        colback=bgcolor,
        colframe=fgcolor,
        rounded corners=south,
        rounded corners=north,
        boxrule=0mm,
        drop fuzzy shadow,
        width=\linewidth,
        boxsep=5pt,
        arc=2mm,
        outer arc=2mm,
        listing only,
        listing options={
            style=tcblatex,
            language=shell,
            color=\color{white},
            keywordstyle=\color{white},
            stringstyle=\color{white},
            commentstyle=\color{white},
            numberstyle=\tiny\color{white},
            escapeinside=\,
            breaklines=true,
            frame=none,
        },
        title={\begin{tikzpicture}
            \fill[clcolor] (0,0) circle (0.15);
            \fill[micolor] (0.4,0) circle (0.15);
            \fill[macolor] (0.8,0) circle (0.15);
        \end{tikzpicture}\hspace{0.39\linewidth}\textcolor{white}{kitty}\hspace{0.5\linewidth}
        },
        minted language=hybris,
        minted style=lightbulb,
        minted options={
                fontsize=\footnotesize,
                tabsize=2,
                breaklines,
                autogobble
        }
}

\newtcblisting{lite-xlstyle}{
        enhanced,
        colback=bgcolor,
        colframe=fgcolor,
        rounded corners=south,
        rounded corners=north,
        boxrule=0mm,
        drop fuzzy shadow,
        width=\linewidth,
        boxsep=5pt,
        arc=2mm,
        outer arc=2mm,
        listing only,
        listing options={
            style=tcblatex,
            language=cpp,
            color=\color{white},
            basicstyle=\ttfamily\footnotesize\color{white},
            keywordstyle=\color{white},
            stringstyle=\color{white},
            commentstyle=\color{white},
            numberstyle=\tiny\color{white},
            escapeinside=\,
            breaklines=true,
            frame=none,
        },
        title={\begin{tikzpicture}
            \fill[clcolor] (0,0) circle (0.15);
            \fill[micolor] (0.4,0) circle (0.15);
            \fill[macolor] (0.8,0) circle (0.15);
        \end{tikzpicture}\hspace{0.39\linewidth}\textcolor{white}{lite-xl}\hspace{0.5\linewidth}
        },
        minted language=cpp,
        minted style=paraiso-dark,
        minted options={
                fontsize=\footnotesize,
                tabsize=2,
                breaklines,
                autogobble
        }
}


% == TIKZ ==
\makeatletter
\tikzset{
  dot diameter/.store in=\dot@diameter,
  dot diameter=3pt,
  dot spacing/.store in=\dot@spacing,
  dot spacing=10pt,
  dots/.style={
    line width=\dot@diameter,
    line cap=round,
    dash pattern=on 0pt off \dot@spacing
  }
}
\makeatother

\renewcommand{\thegostappendix}{\Asbuk{gostappendix}}

\newcommand{\SeeApp}[1]{(см.~приложение~\ref{#1})}
\newcommand{\InApp}[1]{приложении~\ref{#1}}

% Gost appendix implementation
\makeatletter
\newif\if@gostappstarted
\@gostappstartedfalse

\define@key{gostapp}{ext}{\def\gostapp@ext{#1}}
\define@key{gostapp}{label}{\def\gostapp@label{#1}}
\define@key{gostapp}{showname}[true]{\def\gostapp@showname{#1}}
\define@key{gostapp}{tree}[true]{\def\gostapp@tree{#1}}
\define@key{gostapp}{include}{\def\gostapp@include{#1}}

% Default values
\def\gostapp@ext{c,h}
\def\gostapp@label{}
\def\gostapp@showname{true}
\def\gostapp@tree{false}
\def\gostapp@include{}

\newcommand{\MakeGostAppendix}[3][]{%
    \setkeys{gostapp}{#1}%
    \clearpage

    % Add section of there is none
    \if@gostappstarted
    \else
        \phantomsection
        \addcontentsline{toc}{section}{Приложения}
        \section*{Приложения}
        \@gostappstartedtrue
        \vspace{1em}
    \fi

    \refstepcounter{gostappendix}

    \protected@edef\@currentlabel{\Asbuk{gostappendix}}

    \ifx\gostapp@label\@empty\else
        \label{\gostapp@label}
    \fi

    \addcontentsline{toc}{subsection}{Приложение \Asbuk{gostappendix}:\quad #2}

    \begin{center}
        {\Large ПРИЛОЖЕНИЕ \Asbuk{gostappendix}}\\
        \vspace{0.5em}
        {\bfseries#2}
    \end{center}
    \vspace{1em}

    \directlua{print_code_appendix(
        "#3",
        "\gostapp@ext",
        "\gostapp@showname",
        "\gostapp@label",
        "\gostapp@tree",
        "\gostapp@include"
    )}

    \def\gostapp@ext{c,h}
    \def\gostapp@label{}
    \def\gostapp@showname{true}
    \def\gostapp@tree{false}
    \def\gostapp@include{}
}
\makeatother
